<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>SpeakMCP</title>
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' blob: assets:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:"
    />
    <script>
      function applyThemeClass(resolved) {
        const root = document.documentElement
        root.classList.remove("dark", "frost")
        if (resolved === "dark") {
          root.classList.add("dark")
        } else if (resolved === "frost") {
          root.classList.add("frost")
        }
      }

      function getThemePreference() {
        try {
          // Try to get theme preference from config
          const configData = localStorage.getItem("theme-preference")
          if (configData && ["light", "dark", "frost", "system"].includes(configData)) {
            return configData
          }
        } catch (e) {
          // Fallback to frost theme
        }
        return "frost"
      }

      function resolveTheme(preference) {
        if (preference === "light") return "light"
        if (preference === "dark") return "dark"
        if (preference === "frost") return "frost"
        return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"
      }

      function applyTheme(themePreference = null) {
        const preference = themePreference || getThemePreference()
        applyThemeClass(resolveTheme(preference))
      }

      function initThemeClass() {
        applyTheme()
      }

      // Listen for system theme changes only if using system preference
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
          const preference = getThemePreference()
          if (preference === "system") {
            applyThemeClass(e.matches ? "dark" : "light")
          }
        })

      // Listen for theme preference changes from the app
      window.addEventListener("theme-preference-changed", (e) => {
        const newPreference = e.detail
        localStorage.setItem("theme-preference", newPreference)
        applyTheme(newPreference)
      })

      initThemeClass()
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
